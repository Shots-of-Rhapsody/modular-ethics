name: Validate scenarios.json

on:
  push:
    paths:
      - "data/scenarios.json"
      - "schemas/scenarios.schema.json"
  pull_request:
    paths:
      - "data/scenarios.json"
      - "schemas/scenarios.schema.json"

jobs:
  validate:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      # Quick JSON syntax sanity checks (helpful error messages if quotes/commas are off)
      - name: Sanity check JSON (schema)
        shell: bash
        run: node -e "JSON.parse(require('fs').readFileSync('schemas/scenarios.schema.json','utf8'))"

      - name: Sanity check JSON (data)
        shell: bash
        run: node -e "JSON.parse(require('fs').readFileSync('data/scenarios.json','utf8'))"

      # Validate with ajv using npx (no global install; consistent on Ubuntu/Windows)
      - name: Validate scenarios.json against schema
        shell: bash
        run: npx -y ajv-cli@6.0.0 validate -s schemas/scenarios.schema.json -d data/scenarios.json --spec=draft2020
