<!doctype html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/assets/bundle.css">
  <!-- Meta -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contribute - Ethics Testbed</title>
  <meta name="description" content="How to reproduce, author scenarios, extend modules, and share results for the Ethics Testbed.">
  <meta name="theme-color" content="#00A86B">

  <!-- Open Graph -->
  <meta property="og:title" content="Contribute - Ethics Testbed">
  <meta property="og:description" content="A practical guide for reproducing results, authoring new scenarios, and extending modules.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://xartaiusx.github.io/ethics-testbed/contribute.html">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <!-- Styles (harmonized) -->
  <style>
    :root{
      --jade:#00A86B;
      --ink:#0b1220;
      --ink-2:#1f2637;
      --fog:#f6f7fb;
      --muted:#6b7280;
      --ring:rgba(0,168,107,.25);
      --radius:14px;
      --maxw:980px;
    }
    @media (prefers-color-scheme: dark){
      :root{ --ink:#0b0f14; --ink-2:#111827; --fog:#0b0f14; --muted:#9aa4b2; }
      body{ color-scheme: dark; }
    }
    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color:#111827;
      background:linear-gradient(180deg,#ffffff 0%,#fafcff 100%);
    }
    @media (prefers-color-scheme: dark){
      body{ color:#e5e7eb; background:radial-gradient(1200px 600px at 20% -10%, #0c1720, transparent), #0b0f14; }
    }
    a{ color:var(--jade); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    header{
      position:sticky; top:0; z-index:40;
      backdrop-filter:saturate(120%) blur(10px);
      background: color-mix(in srgb, var(--fog) 80%, transparent);
      border-bottom:1px solid color-mix(in srgb, var(--muted) 20%, transparent);
    }
    .wrap{ max-width:var(--maxw); margin:0 auto; padding:0 20px; }
    .nav{ display:flex; align-items:center; justify-content:space-between; height:64px; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px; }
    .brand-logo{ width:28px; height:28px; border-radius:8px; background:conic-gradient(from 180deg at 50% 50%, #00a86b, #00c38a, #00a86b); }

    main{ padding:36px 0 64px; }
    h1,h2,h3{ font-family:"Playfair Display", Georgia, serif; }
    h1{ font-size: clamp(32px, 4vw, 44px); margin:6px 0 10px; line-height:1.15; }
    h2{ font-size: clamp(24px, 3vw, 32px); margin:34px 0 12px; }
    h3{ font-size: 20px; margin:22px 0 8px; }
    .kicker{
      display:inline-flex; align-items:center; gap:8px;
      font-weight:700; text-transform:uppercase; letter-spacing:.12em;
      color:var(--jade);
      background: color-mix(in srgb, var(--jade) 12%, transparent);
      padding:6px 10px; border-radius:999px; font-size:12px;
    }
    .lead{ color:var(--muted); font-size:18px; line-height:1.7; }
    .meta{ color:var(--muted); font-size:13px; }
    .toc{
      margin:14px 0 22px; padding:14px; border:1px solid color-mix(in srgb, var(--muted) 18%, transparent);
      border-radius:12px; background: color-mix(in srgb, var(--jade) 6%, transparent);
    }
    .toc ol{ margin:0; padding-left:18px; }
    section{ scroll-margin-top:76px; }
    .box{
      border:1px solid color-mix(in srgb, var(--jade) 24%, transparent);
      background: color-mix(in srgb, var(--jade) 7%, transparent);
      border-radius:12px; padding:14px 16px; margin:14px 0;
    }
    .grid2{ display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width:920px){ .grid2{ grid-template-columns:1fr 1fr; } }
    pre, code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background:#0d1117; color:#e5e7eb;
    }
    pre{ padding:14px; border-radius:12px; overflow:auto; border:1px solid #1f2937; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; color:var(--jade);
      background: color-mix(in srgb, var(--jade) 12%, transparent);
      border:1px solid color-mix(in srgb, var(--jade) 24%, transparent);
    }
    .callout{
      border-left:4px solid var(--jade); padding:10px 12px; background: color-mix(in srgb, #fff 92%, var(--jade) 8%); border-radius:8px;
    }
    .foot{
      margin-top:40px; padding-top:20px; border-top:1px dashed color-mix(in srgb, var(--muted) 24%, transparent);
      color:var(--muted); font-size:12px;
    }
    .btn{ display:inline-block; font-weight:700; padding:10px 16px; border-radius:999px; background:var(--jade); color:#fff; box-shadow:0 6px 18px -8px var(--ring),0 2px 6px -2px var(--ring); }
    .btn:hover{ text-decoration:none; }
  </style>
</head>
<body>

  <!-- Header -->
<header>
  <div class="nav-container">
    <!-- Brand -->
    <a class="brand" href="/">
      <span class="brand-logo" aria-hidden="true"></span>
      <span class="brand-name">Ethics Testbed</span>
    </a>

    <!-- Navigation -->
    <nav class="site-nav">
      <!-- Mobile toggle -->
      <button class="menu" aria-label="Menu" onclick="
        const list = this.nextElementSibling;
        list.classList.toggle('is-open');
      ">☰</button>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/contribute.html">Contribute</a></li>
        <li><a href="/interactive.html">Interactive</a></li>
        <li><a href="/language-math.html">Language &amp; Math</a></li>
        <li><a href="/paper.html">Paper</a></li>
        <li><a href="/research.html">Research</a></li>
        <li><a href="/results.html">Results</a></li>
        <li><a href="/stories.html">Stories</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>

    <!-- Right CTA: Repo link -->
    <div class="nav-cta">
      <a class="btn outline icon" href="https://github.com/xartaiusx/ethics.testbed" target="_blank" rel="noopener">
        <svg width="18" height="18" viewBox="0 0 16 16" aria-hidden="true">
          <path fill="currentColor" d="M8 0a8 8 0 0 0-2.53 15.6c.4.07.55-.17.55-.38v-1.33c-2.23.49-2.7-1.07-2.7-1.07-.36-.9-.9-1.14-.9-1.14-.73-.49.06-.48.06-.48.8.06 1.22.83 1.22.83.72 1.22 1.88.86 2.34.66.07-.52.28-.86.5-1.05-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.58.82-2.13-.08-.2-.36-1.01.08-2.11 0 0 .67-.21 2.2.81a7.6 7.6 0 0 1 2-.27 7.6 7.6 0 0 1 2 .27c1.53-1.02 2.2-.81 2.2-.81.44 1.1.16 1.9.08 2.11.51.55.82 1.26.82 2.13 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.47v2.18c0 .21.15.46.55.38A8 8 0 0 0 8 0z"/>
        </svg>
        <span class="sr-only">View Repo</span>
      </a>
    </div>
  </div>
</header>

  <main class="wrap" id="main">
    <!-- Title -->
    <p class="kicker">Contribute</p>
    <h1>Reproduce, Author, Extend</h1>
    <p class="meta">Version 0.1 · <span id="date"></span> · MIT License</p>

    <!-- Intro -->
    <section id="intro">
      <p class="lead">
        This page shows how to (1) reproduce results, (2) author new scenarios in JSON,
        (3) extend the engine with new ethical modules, and (4) export runs for review.
        Facts live in scenarios; values live in modules. Keep that boundary sharp.
      </p>
    </section>

    <!-- TOC -->
    <section id="toc" class="toc">
      <strong>Contents</strong>
      <ol>
        <li><a href="#quickstart">Quickstart</a></li>
        <li><a href="#authoring">Scenario Authoring Guide</a></li>
        <li><a href="#modules">Module Extension Guide</a></li>
        <li><a href="#export">Export & Reproducibility</a></li>
        <li><a href="#ledger">Axiom Ledger (Ground Rules)</a></li>
        <li><a href="#faq">FAQ</a></li>
      </ol>
    </section>

    <!-- Quickstart -->
    <button id="validateJson" class="btn">Validate scenarios.json</button>
    <pre id="validateOut" style="margin-top:10px;white-space:pre-wrap"></pre>

    <section id="quickstart">
      <h2>1. Quickstart</h2>
      <div class="grid2">
        <div>
          <h3>Local</h3>
          <ol>
            <li>Clone or fork the repo.</li>
            <li>Open <code>index.html</code> in a modern browser. No build step required.</li>
            <li>Open <code>results.html</code> (baseline) and <code>interactive.html</code> (live controls).</li>
          </ol>
          <div class="box">
            <strong>Tip.</strong> If you use VS Code, the “Live Server” extension auto-reloads your edits.
          </div>
        </div>
        <div>
          <h3>GitHub Pages</h3>
          <ol>
            <li>Enable Pages in your repo settings (source: root or <code>/docs</code>).</li>
            <li>Visit your Pages URL and test <code>interactive.html</code>.</li>
            <li>Confirm that <code>data/scenarios.json</code> is publicly readable.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- Scenario Authoring -->
    <section id="authoring">
      <h2>2. Scenario Authoring Guide</h2>
      <p>Author facts in JSON. Avoid comments and trailing commas-this is strict JSON.</p>

      <h3>2.1 Minimal template</h3>
      <pre><code>{
  "id": "your-scenario-id",
  "context": { "domain": "triage|evacuation|policy|...", "tags": ["free", "text"] },
  "agents": [
    { "id": "X", "role": "patient|rescuer|citizen",
      "baseline": { "wellbeing": 0.50, "years_left": 30 },
      "consent": true }
  ],
  "actions": [
    { "id": "a1", "desc": "What the agent(s) do" },
    { "id": "a2", "desc": "Alternative action" }
  ],
  "outcomes": { /* optional; many scenarios compute outcomes from fields */ },
  "constraints": {
    "no_intentional_harm_innocent": true,
    "treat_like_cases_alike": true,
    "respect_informed_consent": true
  },
  "params": { "priority_fn": "sqrt" },
  "notes": "assumptions and scope limits"
}</code></pre>

      <h3>2.2 Examples</h3>
      <details open>
        <summary><strong>Ventilator triage (seed)</strong></summary>
        <pre><code>{
  "id": "triage-vent-v1",
  "context": { "domain": "triage", "tags": ["emergency", "resource-scarce"] },
  "agents": [
    { "id": "A", "baseline": { "wellbeing": 0.55, "years_left": 35 }, "consent": true,
      "survival": { "vent": 0.80, "no_vent": 0.10 } },
    { "id": "B", "baseline": { "wellbeing": 0.55, "years_left": 35 }, "consent": true,
      "survival": { "vent": 0.60, "no_vent": 0.55 } }
  ],
  "actions": [
    { "id": "a1_allocate_A", "desc": "Allocate ventilator to A" },
    { "id": "a2_allocate_B", "desc": "Allocate ventilator to B" },
    { "id": "a3_lottery", "desc": "Random lottery (50/50)" }
  ],
  "constraints": {
    "no_intentional_harm_innocent": true,
    "treat_like_cases_alike": true,
    "respect_informed_consent": true
  },
  "params": { "priority_fn": "sqrt" }
}</code></pre>
      </details>

      <details>
        <summary><strong>Flood evacuation (seed)</strong></summary>
        <pre><code>{
  "id": "evac-promise-v1",
  "context": { "domain": "evacuation", "tags": ["flood", "resource-scarce"] },
  "agents": [
    { "id": "D1", "role": "civilian", "traits": ["elderly"], "promised_first": true },
    { "id": "D2", "role": "civilian" }, { "id": "D3", "role": "civilian" },
    { "id": "D4", "role": "civilian" }, { "id": "D5", "role": "civilian" },
    { "id": "R",  "role": "rescuer" }
  ],
  "boat_capacity": 3,
  "prob_survive_if_rescued": 0.95,
  "prob_if_delayed": { "east": 0.60, "west": 0.20 },
  "docks": { "east": ["D1","D2","D3"], "west": ["D4","D5"] },
  "actions": [
    { "id": "b1_east_now", "desc": "Rescue East (D1–D3) now" },
    { "id": "b2_west_plus_one_east", "desc": "Rescue West (D4–D5) + one East" },
    { "id": "b3_mixed_break_promise", "desc": "Two East (incl. D1) + one West" }
  ],
  "constraints": {
    "keep_credible_promises": { "enabled": true, "theta_lives": 1.0 },
    "no_intentional_harm_innocent": true,
    "treat_like_cases_alike": true
  },
  "params": { "priority_fn": "sqrt" }
}</code></pre>
      </details>

      <div class="callout">
        <strong>Validation.</strong> Open your JSON file directly in the browser.
        If it renders as text without error, it’s valid. JSON does not allow comments or trailing commas.
      </div>
    </section>

    <!-- Module Extension Guide -->
    <section id="modules">
      <h2>3. Module Extension Guide</h2>
      <p>Modules live in <code>js/engine.js</code>. Each should either (a) return a scalar choiceworthiness for every action, or (b) gate actions via admissibility constraints.</p>

      <h3>3.1 Shape</h3>
      <pre><code>// Scalar module
function CW_newTheory(scn) {
  // return Array&lt;[actionId, number]&gt; or Map(actionId -&gt; number)
}

// Constraint module (admissibility)
function gk_newConstraint(scn, actionId) {
  // return { admissible: boolean, reasons: string[] }
}</code></pre>

      <h3>3.2 Example: Rawlsian maximin</h3>
      <pre><code>// Compute minimum expected well-being across persons
function rawlsRawScores(scn) {
  // You define how to derive per-person utility from scn (e.g., survival * years_left)
  // Return pairs: [[actionId, score], ...]
}</code></pre>

      <h3>3.3 Wiring it in</h3>
      <ol>
        <li>Compute raw scores per action.</li>
        <li>Normalize to [0,1] within the scenario (min–max).</li>
        <li>Add a credence weight in the aggregator (alongside consequentialism and virtue).</li>
      </ol>
      <div class="box">
        <strong>Guardrails.</strong> Keep rights as side-constraints (lexicographic). Don’t bury them as soft penalties.
      </div>
    </section>

    <!-- Export & Repro -->
    <section id="export">
      <h2>4. Export & Reproducibility</h2>
      <p>
        Use <a href="interactive.html">Interactive</a> → “Download current run (JSON)”. Each bundle captures:
      </p>
      <ul>
        <li>Timestamp</li>
        <li>Ledger version</li>
        <li>Settings (credences, promise rule, virtue weights)</li>
        <li>Scenario IDs</li>
        <li>Per-scenario ranking, admissibility notes, explanation set</li>
      </ul>
      <pre><code>{
  "timestamp": "2025-09-05T12:34:56.789Z",
  "ledger_version": "0.1",
  "settings": { "credences": {"p_cons":0.5,"p_virtue":0.5}, "promise": {"enabled":true,"theta_lives":1.0} },
  "scenarios": ["triage-vent-v1", "evac-promise-v1"],
  "results": [
    { "scenarioId": "triage-vent-v1", "ranking": [["a1_allocate_A",0.92],["a3_lottery",0.61],...],
      "admissibility": [["a1_allocate_A",{"admissible":true,"reasons":[]}]], "explanations": ["E1: ..."] }
  ]
}</code></pre>
      <div class="callout">
        <strong>How to discuss disagreements.</strong> Share your exported JSON, point to the specific axiom or parameter you contest, and show the change in results.
      </div>
    </section>

    <!-- Ledger -->
    <section id="ledger">
      <h2>5. Axiom Ledger (Ground Rules)</h2>
      <p>Short, explicit premises that shape the engine’s behavior.</p>
      <ol>
        <li>Persons have equal moral worth.</li>
        <li>Comparable goods are explicitly scaled within each scenario.</li>
        <li>Uncertainty is modeled; guesses are distributions.</li>
        <li>Rights and duties act as side-constraints (lexicographic priority).</li>
        <li>Doing vs allowing matters but is not decisive alone.</li>
        <li>Consent changes scores and constraint triggers.</li>
        <li>Priority to the worse-off via concavity or priority weights.</li>
        <li>Like cases alike; only prognosis-relevant differences justify unequal treatment.</li>
        <li>Minimal explanations identify the few premises that did the work.</li>
        <li>Pluralism is explicit; red lines are not aggregative.</li>
        <li>Culture tunes parameters, not personhood.</li>
        <li>Reversibility check flags unstable rules.</li>
      </ol>
      <div class="box">
        <strong>To propose changes:</strong> cite the axiom by number, suggest a replacement, and attach a run bundle showing effects on scenarios.
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq">
      <h2>6. FAQ</h2>
      <h3>Why strict JSON and not YAML?</h3>
      <p>We want zero ambiguity and native browser parsing via <code>fetch</code> → <code>response.json()</code>.</p>

      <h3>Can I add culture-specific parameters?</h3>
      <p>Yes-under <code>context.culture</code>. Modules may read them to tune thresholds (e.g., consent).</p>

      <h3>Where do I put new modules?</h3>
      <p>Add functions in <code>js/engine.js</code>, mirror the normalization, and update aggregation weights.</p>

      <h3>What counts as a deontic constraint vs a soft penalty?</h3>
      <p>If it’s a right/duty that should not be traded off, encode as admissibility (gate). Otherwise, use scalar modules.</p>
    </section>

    <div class="foot">
      <a class="btn" href="index.html">Back to Home</a>
      <p>© <span id="y"></span> Ethics Testbed · <a href="LICENSE" target="_blank" rel="noopener">MIT</a></p>
    </div>
  </main>

  <!-- Scripts -->
  <script>
    // Date + year
    const d = new Date();
    document.getElementById('date').textContent = d.toLocaleDateString(undefined, {year:'numeric', month:'long', day:'numeric'});
    document.getElementById('y').textContent = d.getFullYear();

    // Rebuild ToC in case sections change (optional)
    (function rebuildTOC(){
      const toc = document.querySelector('#toc ol');
      if (!toc) return;
      const ids = ['quickstart','authoring','modules','export','ledger','faq'];
      const labels = ['Quickstart','Scenario Authoring Guide','Module Extension Guide','Export & Reproducibility','Axiom Ledger (Ground Rules)','FAQ'];
      toc.innerHTML = ids.map((id,i)=>`<li><a href="#${id}">${labels[i]}</a></li>`).join('');
    })();
  </script>
  <script>
document.getElementById('validateJson').addEventListener('click', async () => {
  const out = document.getElementById('validateOut');
  out.textContent = 'Validating…';
  try {
    const res = await fetch('data/scenarios.json', {cache:'no-store'});
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const text = await res.text();
    try {
      const parsed = JSON.parse(text);
      if (!parsed || !Array.isArray(parsed.scenarios)) throw new Error('Missing "scenarios" array.');
      // quick structure pokes
      const ids = new Set();
      for (const s of parsed.scenarios) {
        if (!s.id) throw new Error('Scenario missing id.');
        if (ids.has(s.id)) throw new Error('Duplicate scenario id: ' + s.id);
        ids.add(s.id);
      }
      out.textContent = '✅ scenarios.json is valid. Scenarios: ' + [...ids].join(', ');
    } catch (e) {
      // try to locate the error position if possible
      out.textContent = '❌ JSON parse error: ' + e.message;
    }
  } catch (e) {
    out.textContent = '❌ Could not load data/scenarios.json: ' + e.message;
  }
});
</script>
<script src="/src/js/index.js"></script>
</body>
</html>
