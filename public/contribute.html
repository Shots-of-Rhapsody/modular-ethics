<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="/assets/bundle.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contribute - Ethics Testbed</title>
  <meta name="description" content="How to reproduce, author scenarios, extend modules, and share results for the Ethics Testbed." />
  <meta name="theme-color" content="#00A86B" />

  <!-- Open Graph -->
  <meta property="og:title" content="Contribute - Ethics Testbed" />
  <meta property="og:description" content="A practical guide for reproducing results, authoring new scenarios, and extending modules." />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://shotsofrhapsody.com/contribute.html" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <a class="skip" href="#main">Skip to content</a>

  <!-- Shared header -->
  <div id="site-header"></div>
  <script type="module" src="/src/js/header.js"></script>

  <main class="wrap" id="main">
    <!-- Title -->
    <p class="kicker">Contribute</p>
    <h1>Reproduce, Author, Extend</h1>
    <p class="muted">Version 0.1 · <span id="date"></span> · MIT License</p>

    <!-- Intro -->
    <section id="intro">
      <p class="lead">
        This page shows how to (1) reproduce results, (2) author new scenarios in JSON,
        (3) extend the engine with new ethical modules, and (4) export runs for review.
        Facts live in scenarios; values live in modules. Keep that boundary sharp.
      </p>
    </section>

    <!-- TOC -->
    <section id="toc" class="toc">
      <strong>Contents</strong>
      <ol>
        <li><a href="#quickstart">Quickstart</a></li>
        <li><a href="#authoring">Scenario Authoring Guide</a></li>
        <li><a href="#modules">Module Extension Guide</a></li>
        <li><a href="#export">Export &amp; Reproducibility</a></li>
        <li><a href="#ledger">Axiom Ledger (Ground Rules)</a></li>
        <li><a href="#faq">FAQ</a></li>
      </ol>
    </section>

    <!-- Quickstart -->
    <button id="validateJson" class="btn">Validate scenarios.json</button>
    <pre id="validateOut" class="sp-2" style="white-space:pre-wrap"></pre>

    <section id="quickstart">
      <h2>1. Quickstart</h2>
      <div class="grid" style="grid-template-columns:1fr;gap:16px">
        <div class="card">
          <h3>Local</h3>
          <ol>
            <li>Clone or fork the repo.</li>
            <li>Open <code>/index.html</code> in a modern browser.</li>
            <li>Open <code>/results.html</code> (baseline) and <code>/interactive.html</code> (live controls).</li>
          </ol>
          <p class="tiny muted">Tip: If you use VS Code, the “Live Server” extension auto-reloads edits.</p>
        </div>
        <div class="card">
          <h3>GitHub Pages</h3>
          <ol>
            <li>Enable Pages in repo settings (source: GitHub Actions).</li>
            <li>Visit your Pages URL and test <code>/interactive.html</code>.</li>
            <li>Confirm <code>/data/scenarios.json</code> is publicly readable.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- Scenario Authoring -->
    <section id="authoring">
      <h2>2. Scenario Authoring Guide</h2>
      <p>Author facts in JSON. Avoid comments and trailing commas—this is strict JSON.</p>

      <h3>2.1 Minimal template</h3>
      <div class="card">
        <pre><code>{
  "id": "your-scenario-id",
  "context": { "domain": "triage|evacuation|policy|...", "tags": ["free", "text"] },
  "agents": [
    { "id": "X", "role": "patient|rescuer|citizen",
      "baseline": { "wellbeing": 0.50, "years_left": 30 },
      "consent": true }
  ],
  "actions": [
    { "id": "a1", "desc": "What the agent(s) do" },
    { "id": "a2", "desc": "Alternative action" }
  ],
  "constraints": {
    "no_intentional_harm_innocent": true,
    "treat_like_cases_alike": true,
    "respect_informed_consent": true
  },
  "params": { "priority_fn": "sqrt" },
  "notes": "assumptions and scope limits"
}</code></pre>
      </div>

      <h3>2.2 Examples</h3>
      <details open>
        <summary><strong>Ventilator triage (seed)</strong></summary>
        <div class="card">
<pre><code>{
  "id": "triage-vent-v1",
  "context": { "domain": "triage", "tags": ["emergency", "resource-scarce"] },
  "agents": [
    { "id": "A", "baseline": { "wellbeing": 0.55, "years_left": 35 }, "consent": true,
      "survival": { "vent": 0.80, "no_vent": 0.10 } },
    { "id": "B", "baseline": { "wellbeing": 0.55, "years_left": 35 }, "consent": true,
      "survival": { "vent": 0.60, "no_vent": 0.55 } }
  ],
  "actions": [
    { "id": "a1_allocate_A", "desc": "Allocate ventilator to A" },
    { "id": "a2_allocate_B", "desc": "Allocate ventilator to B" },
    { "id": "a3_lottery", "desc": "Random lottery (50/50)" }
  ],
  "constraints": {
    "no_intentional_harm_innocent": true,
    "treat_like_cases_alike": true,
    "respect_informed_consent": true
  },
  "params": { "priority_fn": "sqrt" }
}</code></pre>
        </div>
      </details>

      <details>
        <summary><strong>Flood evacuation (seed)</strong></summary>
        <div class="card">
<pre><code>{
  "id": "evac-promise-v1",
  "context": { "domain": "evacuation", "tags": ["flood", "resource-scarce"] },
  "agents": [
    { "id": "D1", "role": "civilian", "traits": ["elderly"], "promised_first": true },
    { "id": "D2", "role": "civilian" }, { "id": "D3", "role": "civilian" },
    { "id": "D4", "role": "civilian" }, { "id": "D5", "role": "civilian" },
    { "id": "R",  "role": "rescuer" }
  ],
  "boat_capacity": 3,
  "prob_survive_if_rescued": 0.95,
  "prob_if_delayed": { "east": 0.60, "west": 0.20 },
  "docks": { "east": ["D1","D2","D3"], "west": ["D4","D5"] },
  "actions": [
    { "id": "b1_east_now", "desc": "Rescue East (D1–D3) now" },
    { "id": "b2_west_plus_one_east", "desc": "Rescue West (D4–D5) + one East" },
    { "id": "b3_mixed_break_promise", "desc": "Two East (incl. D1) + one West" }
  ],
  "constraints": {
    "keep_credible_promises": { "enabled": true, "theta_lives": 1.0 },
    "no_intentional_harm_innocent": true,
    "treat_like_cases_alike": true
  },
  "params": { "priority_fn": "sqrt" }
}</code></pre>
        </div>
      </details>

      <div class="card">
        <p><strong>Validation.</strong> Open your JSON file directly in the browser.
        If it renders as text without error, it’s valid. JSON does not allow comments or trailing commas.</p>
      </div>
    </section>

    <!-- Module Extension Guide -->
    <section id="modules">
      <h2>3. Module Extension Guide</h2>
      <p>Modules live in the engine code. Each should either (a) return a scalar choiceworthiness for every action, or (b) gate actions via admissibility constraints.</p>

      <h3>3.1 Shape</h3>
      <div class="card">
<pre><code>// Scalar module
function CW_newTheory(scn) {
  // return Array&lt;[actionId, number]&gt; or Map(actionId =&gt; number)
}

// Constraint module (admissibility)
function gk_newConstraint(scn, actionId) {
  // return { admissible: boolean, reasons: string[] }
}</code></pre>
      </div>

      <h3>3.2 Example: Rawlsian maximin</h3>
      <div class="card">
<pre><code>// Compute minimum expected well-being across persons
function rawlsRawScores(scn) {
  // You define how to derive per-person utility from scn (e.g., survival * years_left)
  // Return pairs: [[actionId, score], ...]
}</code></pre>
      </div>

      <h3>3.3 Wiring it in</h3>
      <ol>
        <li>Compute raw scores per action.</li>
        <li>Normalize to [0,1] within the scenario (min–max).</li>
        <li>Add a credence weight in the aggregator (alongside consequentialism and virtue).</li>
      </ol>
      <div class="card">
        <p><strong>Guardrails.</strong> Keep rights as side-constraints (lexicographic). Don’t bury them as soft penalties.</p>
      </div>
    </section>

    <!-- Export & Repro -->
    <section id="export">
      <h2>4. Export &amp; Reproducibility</h2>
      <p>
        Use <a href="/interactive.html">Interactive</a> → “Download current run (JSON)”. Each bundle captures:
      </p>
      <ul>
        <li>Timestamp</li>
        <li>Ledger version</li>
        <li>Settings (credences, promise rule, virtue weights)</li>
        <li>Scenario IDs</li>
        <li>Per-scenario ranking, admissibility notes, explanation set</li>
      </ul>
      <div class="card">
<pre><code>{
  "timestamp": "2025-09-05T12:34:56.789Z",
  "ledger_version": "0.1",
  "settings": { "credences": {"p_cons":0.5,"p_virtue":0.5}, "promise": {"enabled":true,"theta_lives":1.0} },
  "scenarios": ["triage-vent-v1", "evac-promise-v1"],
  "results": [
    { "scenarioId": "triage-vent-v1", "ranking": [["a1_allocate_A",0.92],["a3_lottery",0.61]],
      "admissibility": [["a1_allocate_A",{"admissible":true,"reasons":[]}]],
      "explanations": ["E1: ..."] }
  ]
}</code></pre>
      </div>

      <div class="card">
        <p><strong>How to discuss disagreements.</strong> Share your exported JSON, point to the specific axiom or parameter you contest, and show the change in results.</p>
      </div>
    </section>

    <!-- Ledger -->
    <section id="ledger">
      <h2>5. Axiom Ledger (Ground Rules)</h2>
      <ol class="list-axioms">
        <li><strong>A1.</strong> Persons have equal moral worth.</li>
        <li><strong>A2.</strong> Comparable goods are explicitly scaled within each scenario.</li>
        <li><strong>A3.</strong> Uncertainty is modeled; guesses are distributions.</li>
        <li><strong>A4.</strong> Rights/duties act as side-constraints (lexicographic priority).</li>
        <li><strong>A5.</strong> Doing vs allowing matters but is not decisive alone.</li>
        <li><strong>A6.</strong> Consent changes scores & constraint triggers.</li>
        <li><strong>A7.</strong> Priority to the worse-off via concavity/priority.</li>
        <li><strong>A8.</strong> Like cases alike; only prognosis-relevant differences justify unequal treatment.</li>
        <li><strong>A9.</strong> Minimal explanations: identify the few premises that did the work.</li>
        <li><strong>A10.</strong> Pluralism is explicit; red lines are not aggregative.</li>
        <li><strong>A11.</strong> Culture tunes parameters, not personhood.</li>
        <li><strong>A12.</strong> Reversibility check flags unstable rules.</li>
      </ol>
      <div class="card">
        <p><strong>To propose changes:</strong> cite the axiom by number, suggest a replacement, and attach a run bundle showing effects on scenarios.</p>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq">
      <h2>6. FAQ</h2>
      <h3>Why strict JSON and not YAML?</h3>
      <p>We want zero ambiguity and native browser parsing via <code>fetch</code> → <code>response.json()</code>.</p>

      <h3>Can I add culture-specific parameters?</h3>
      <p>Yes—under <code>context.culture</code>. Modules may read them to tune thresholds (e.g., consent).</p>

      <h3>Where do I put new modules?</h3>
      <p>Add functions in the engine, mirror the normalization, and update aggregation weights.</p>

      <h3>What counts as a deontic constraint vs a soft penalty?</h3>
      <p>If it’s a right/duty that should not be traded off, encode as admissibility (gate). Otherwise, use scalar modules.</p>
    </section>

    <div class="sp-3"></div>
    <div class="row">
      <a class="btn" href="/index.html">Back to Home</a>
      <a class="btn outline" href="https://github.com/xartaiusx/ethics.testbed" target="_blank" rel="noopener">Repository</a>
    </div>

    <footer class="sp-3 tiny muted">
      © <span id="y"></span> Ethics Testbed · <a href="https://github.com/xartaiusx/ethics.testbed/blob/main/LICENSE" target="_blank" rel="noopener">MIT</a>
    </footer>
  </main>

  <!-- Scripts -->
  <script>
    // Date + year
    const d = new Date();
    const dateEl = document.getElementById('date');
    if (dateEl) dateEl.textContent = d.toLocaleDateString(undefined, {year:'numeric', month:'long', day:'numeric'});
    const yEl = document.getElementById('y');
    if (yEl) yEl.textContent = d.getFullYear();

    // Rebuild ToC (kept simple)
    (function rebuildTOC(){
      const toc = document.querySelector('#toc ol');
      if (!toc) return;
      const ids = ['quickstart','authoring','modules','export','ledger','faq'];
      const labels = ['Quickstart','Scenario Authoring Guide','Module Extension Guide','Export & Reproducibility','Axiom Ledger (Ground Rules)','FAQ'];
      toc.innerHTML = ids.map((id,i)=>`<li><a href="#${id}">${labels[i]}</a></li>`).join('');
    })();

    // Validate scenarios.json (supports array OR {scenarios:[]})
    document.getElementById('validateJson').addEventListener('click', async () => {
      const out = document.getElementById('validateOut');
      out.textContent = 'Validating…';
      try {
        // Always root-absolute so it works on Pages
        const res = await fetch('/data/scenarios.json', {cache:'no-store'});
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        let payload;
        try {
          const parsed = JSON.parse(text);
          payload = Array.isArray(parsed) ? parsed
                   : (Array.isArray(parsed.scenarios) ? parsed.scenarios : null);
          if (!payload) throw new Error('Expected an array or { "scenarios": [...] }.');
          const ids = new Set();
          for (const s of payload) {
            if (!s || typeof s !== 'object') throw new Error('Scenario is not an object.');
            if (!s.id) throw new Error('Scenario missing "id".');
            if (ids.has(s.id)) throw new Error('Duplicate scenario id: ' + s.id);
            ids.add(s.id);
          }
          out.textContent = '✅ scenarios.json is valid. Scenarios: ' + [...ids].join(', ');
        } catch (e) {
          out.textContent = '❌ JSON validation error: ' + e.message;
        }
      } catch (e) {
        out.textContent = '❌ Could not load /data/scenarios.json: ' + e.message;
      }
    });
  </script>

  <!-- Site bootstrap (shared small helpers, if any) -->
  <script src="/src/js/index.js"></script>
</body>
</html>
