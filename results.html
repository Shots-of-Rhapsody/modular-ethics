<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>First Results — Ethics Testbed</title>
  <meta name="description" content="Baseline runs for the modular ethics engine on seed scenarios.">
  <meta name="theme-color" content="#00A86B">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --jade:#00A86B; --muted:#6b7280; --radius:14px; --maxw:1080px; }
    body{ margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:#fafcff; color:#111827; }
    header{ position:sticky; top:0; backdrop-filter:saturate(120%) blur(10px); background:#ffffffc7; border-bottom:1px solid #e5e7eb; }
    .wrap{ max-width:var(--maxw); margin:0 auto; padding:0 20px; }
    .nav{ display:flex; align-items:center; justify-content:space-between; height:64px; }
    h1,h2{ font-family:"Playfair Display", Georgia, serif; }
    h1{ margin:14px 0; font-size:clamp(28px,4vw,40px); }
    h2{ margin:20px 0 10px; font-size:clamp(22px,3vw,30px); }
    .kicker{ display:inline-flex; gap:8px; padding:6px 10px; border-radius:999px; font-weight:700; letter-spacing:.12em; text-transform:uppercase; color:var(--jade); background:#00a86b1a; }
    .grid{ display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width:960px){ .grid{ grid-template-columns:1fr 1fr; } }
    .card{ background:white; border:1px solid #e5e7eb; border-radius:var(--radius); padding:16px; box-shadow:0 12px 34px -24px rgba(0,0,0,.2); }
    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:8px 10px; border-bottom:1px solid #e5e7eb; font-size:14px; }
    th{ text-align:left; background:#f8fafc; }
    code{ background:#0d1117; color:#e5e7eb; padding:2px 6px; border-radius:8px; font-size:12px; }
    .pill{ display:inline-block; padding:4px 8px; border-radius:999px; background:#00a86b1a; color:#047857; font-weight:700; font-size:12px; }
    .muted{ color:var(--muted); }
    .btn{ display:inline-block; font-weight:700; padding:10px 16px; border-radius:999px; background:var(--jade); color:#fff; text-decoration:none; box-shadow:0 6px 18px -8px rgba(0,168,107,.25), 0 2px 6px -2px rgba(0,168,107,.25); }
    footer{ margin:30px 0 60px; color:var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div><span class="kicker">Baseline Runs</span></div>
      <nav><a href="index.html">Home</a> · <a href="paper.html">Methods</a> · <a href="interactive.html">Interactive</a> · <a href="https://github.com/YOUR_GITHUB_USERNAME/YOUR_REPO" target="_blank" rel="noopener">Repo</a></nav>
    </div>
  </header>

  <main class="wrap">
    <h1>First Results</h1>
    <p class="muted">Aggregator uses credences <code>{ p_cons: 0.5, p_rawls: 0.25, p_virtue: 0.25 }</code>. Deontic constraints gate actions before aggregation.</p>

    <div id="results" class="grid"></div>

    <p><a class="btn" href="index.html">Back to Home</a></p>
  </main>

  <footer class="wrap">
    © <span id="y"></span> Ethics Testbed · MIT License
  </footer>

  <script src="js/engine.js"></script>
  <script>
    document.getElementById('y').textContent = (new Date()).getFullYear();

    async function loadScenarios() {
      const res = await fetch('data/scenarios.json');
      if (!res.ok) throw new Error('Failed to load scenarios.json');
      return (await res.json()).scenarios;
    }

    function fmt(x){ return (typeof x === 'number') ? x.toFixed(3) : (x ?? '—'); }

    function renderScenario(container, scn, evald) {
      const card = document.createElement('div');
      card.className = 'card';

      const inadmissible = [...evald.admissibility.entries()]
        .filter(([,v])=>!v.admissible)
        .map(([k,v])=>`${k} — ${v.reasons.join('; ')}`);

      const actions = scn.actions.map(a=>a.id);
      const row = id => `
        <tr>
          <td><code>${id}</code></td>
          <td>${fmt(evald.consRaw.get(id))}</td>
          <td>${evald.consNorm.get(id).toFixed(3)}</td>
          <td>${fmt(evald.rawlsRaw.get(id))}</td>
          <td>${evald.rawlsNorm.get(id).toFixed(3)}</td>
          <td>${evald.virtueRaw.get(id).toFixed(3)}</td>
          <td>${evald.virtueNorm.get(id).toFixed(3)}</td>
          <td>${(evald.aggregate.get(id)??null) === null ? '—' : evald.aggregate.get(id).toFixed(3)}</td>
          <td>${evald.admissibility.get(id).admissible ? '<span class="pill">Yes</span>' : '<span class="pill" style="background:#fee2e2;color:#991b1b">No</span>'}</td>
        </tr>`;

      card.innerHTML = `
        <h2>${scn.id}</h2>
        <p class="muted">${scn.context?.domain ?? ''} · ${scn.context?.tags?.join(', ') ?? ''}</p>

        <table>
          <thead>
            <tr>
              <th>Action</th>
              <th>Cons. Raw</th>
              <th>Cons. Norm</th>
              <th>Rawls Raw</th>
              <th>Rawls Norm</th>
              <th>Virtue Raw</th>
              <th>Virtue Norm</th>
              <th>Aggregate</th>
              <th>Admissible</th>
            </tr>
          </thead>
          <tbody>
            ${actions.map(row).join('')}
          </tbody>
        </table>

        <p><strong>Ranking:</strong> ${
          evald.ranking.map(([a,s])=>`<code>${a}</code> (${s.toFixed(3)})`).join(' > ')
        }</p>

        ${inadmissible.length ? `<p><strong>Inadmissible:</strong> ${inadmissible.join(' | ')}</p>` : ''}

        <p><strong>Explanation set:</strong> ${evald.explanations.join(' ')} </p>
      `;
      container.appendChild(card);
    }

    (async function main(){
      const container = document.getElementById('results');
      const scenarios = await loadScenarios();
      for (const scn of scenarios) {
        const ev = window.EthicsEngine.evaluateScenario(scn, { credences: { p_cons:0.5, p_rawls:0.25, p_virtue:0.25 } });
        renderScenario(container, scn, ev);
      }
    })();
  </script>
</body>
</html>
